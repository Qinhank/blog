<!DOCTYPE html><html lang="zh-CN"><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><meta name="author" content="Author hank.qin1994@gmail.com"><title>编写可维护的js · Hank</title><meta name="description" content="不知道身为前端er的你有没有过这种体验，几个月前写的代码自己某天回头再看，如果没有详细的注释，发现已经看不懂了，不知道到底是干嘛的了。如果没有这种体验，那一定有过另一种体验：同事之前写的代码有些没有注释，完全看不懂。所以说编写可维护的代码为什么要单独开一篇文章说明，就是因为它太重要了，甚至比如果编写"><meta name="keywords"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="renderer" content="webkit"><link rel="short icon" href="/images/favicon.png" type="image/x-icon"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/blog_basic.css"><link rel="stylesheet" href="/css/font-awesome.min.css"><link rel="alternate" type="application/atom+xml" title="ATOM 1.0" href="/atom.xml"></head><body><div class="sidebar animated fadeInDown"><div class="logo-title"><div class="title"><img src="/images/19928429.png" style="width:127px;"><h3 title=""><a href="/">Hank</a></h3><div class="description"><p>一个前端开发er</p></div></div></div><ul class="social-links"><li><a href="https://github.com/hankqin"><i class="fa fa-github"></i></a></li></ul><div class="footer"><p class="coding">Hosted by <a href="https://pages.coding.me">Coding Pages</a></p></div></div><div class="main"><div class="page-top animated fadeInDown"><div class="nav"><li><a href="/">首页</a></li><li><a href="/about">关于</a></li><li><a href="/archives">归档</a></li><!--liif is_current('links')
  a.current(href="/links")= __('Links')					
else
  a(href="/links")= __('Links')		--></div><div class="information"><div class="back_btn"><li><a class="fa fa-chevron-left" onclick="window.history.go(-1)"> </a></li></div><div class="avatar"><img src="/images/favicon.png"></div></div></div><div class="autopagerize_page_element"><div class="content"><div class="post-page"><div class="post animated fadeInDown"><div class="post-title"><h3><a>编写可维护的js</a></h3></div><div class="post-content"><p>不知道身为前端er的你有没有过这种体验，几个月前写的代码自己某天回头再看，如果没有详细的注释，发现已经看不懂了，不知道到底是干嘛的了。<br>如果没有这种体验，那一定有过另一种体验：同事之前写的代码有些没有注释，完全看不懂。<br>所以说编写可维护的代码为什么要单独开一篇文章说明，就是因为它太重要了，甚至比如果编写js还重要。<br>今儿就把自己学习到的记录下来，时不时的查阅，看看自己到底有没有做到，也算是一种养成良好习惯的磨练吧。  </p>
<h2 id="避免使用全局变量"><a href="#避免使用全局变量" class="headerlink" title="避免使用全局变量"></a>避免使用全局变量</h2><p>这点就没什么好说的了。如果你是一个合格的前端er，你就会知道命名冲突究竟是多少蛋疼的事了。  </p>
<h2 id="如何访问全局对象"><a href="#如何访问全局对象" class="headerlink" title="如何访问全局对象"></a>如何访问全局对象</h2><p>我猜看到这里第一反应应该就是window吧，但是如果我的运行环境不是浏览器呢，这下又怎么办？<br>最好的办法应该是通过一段自执行的函数返回：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> global = (<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">   <span class="keyword">return</span> <span class="keyword">this</span>;</span><br><span class="line">&#125;());</span><br></pre></td></tr></table></figure></p>
<p>当然，很明显，严格模式下这段代码并不能返回你想要的结果(严格模式下函数的this指向undefined)</p>
<h2 id="单var形式"><a href="#单var形式" class="headerlink" title="单var形式"></a>单var形式</h2><p>这个形式有几个优点：  </p>
<ul>
<li>提供了一个单一的地方去寻找功能所需要的所有局部变量</li>
<li>防止变量在定义之前使用的逻辑错误</li>
<li>少代码（类型啊传值啊单线完成）</li>
</ul>
<p>当然现在ES6出了let和const，有了块级作用域，为了防止变量提升，用let或const会比较好。<br>(不过使用时需要注意它们的暂时性死区)<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">func</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">   <span class="keyword">let</span> a = <span class="number">1</span>,</span><br><span class="line">       b = <span class="number">2</span>,</span><br><span class="line">       sum = a + b,</span><br><span class="line">       myobject = &#123;&#125;,</span><br><span class="line">       i,</span><br><span class="line">       j;</span><br><span class="line">   <span class="comment">// function body...</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h2 id="for循环"><a href="#for循环" class="headerlink" title="for循环"></a>for循环</h2><p>for循环大家都懂，但是按照书中的说法，如果简单使用<figure class="highlight plain"><figcaption><span>i</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">再者是i++写法，JSLint推荐使用i+=1，解释是“避免过分棘手(excessive trickiness)”  </span><br><span class="line">所以完整下来应该就是：</span><br><span class="line">``` javascript</span><br><span class="line">for(let i=0,max=something.length;i&lt;max;i+=1)&#123;</span><br><span class="line">  //something[i]...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h2 id="for-in枚举"><a href="#for-in枚举" class="headerlink" title="for-in枚举"></a>for-in枚举</h2><p>该方法用于对象的枚举，虽然数组也可以使用此方法(数组也是对象)，但并不推荐，原因是：  </p>
<blockquote>
<p>如果数组对象已被自定义的功能增强，就可能发生逻辑错误。另外，在for-in中，属性列表的顺序（序列）是不能保证的。所以最好数组使用正常的for循环，对象使用for-in循环。  </p>
</blockquote>
<p>对象的循环本没有什么可说的，但是有个非常强大的东西——原型链，对象会继承原型链下的属性和方法，但常常我们不需要这些属性和方法，于是hasOwnProperty()方法就非常有用了，它:  </p>
<blockquote>
<p>函数用于指示一个对象自身(不包括原型链)是否具有指定名称的属性。如果有，返回true，否则返回false。  </p>
</blockquote>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//第一种使用</span></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">var</span> i <span class="keyword">in</span> man) &#123;</span><br><span class="line">   <span class="keyword">if</span> (man.hasOwnProperty(i)) &#123; <span class="comment">// 过滤</span></span><br><span class="line">      <span class="built_in">console</span>.log(i, <span class="string">":"</span>, man[i]);</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//第二种使用</span></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">var</span> i <span class="keyword">in</span> man) &#123;</span><br><span class="line">   <span class="keyword">if</span> (<span class="built_in">Object</span>.prototype.hasOwnProperty.call(man, i)) &#123; <span class="comment">// 过滤</span></span><br><span class="line">      <span class="built_in">console</span>.log(i, <span class="string">":"</span>, man[i]);</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>如果结合单var形式，写成这样是最优的：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> i, hasOwn = <span class="built_in">Object</span>.prototype.hasOwnProperty;</span><br><span class="line"><span class="keyword">for</span> (i <span class="keyword">in</span> man) &#123;</span><br><span class="line">    <span class="keyword">if</span> (hasOwn.call(man, i)) &#123; <span class="comment">// 过滤</span></span><br><span class="line">        <span class="built_in">console</span>.log(i, <span class="string">":"</span>, man[i]);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h2 id="使用switch"><a href="#使用switch" class="headerlink" title="使用switch"></a>使用switch</h2><p>可以通过类似下面形式的switch语句增强可读性和健壮性：<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> inspect_me = <span class="number">0</span>,</span><br><span class="line">    result = <span class="string">''</span>;</span><br><span class="line"><span class="keyword">switch</span> (inspect_me) &#123;</span><br><span class="line"><span class="keyword">case</span> <span class="number">0</span>:</span><br><span class="line">   result = <span class="string">"zero"</span>;</span><br><span class="line">   <span class="keyword">break</span>;</span><br><span class="line"><span class="keyword">case</span> <span class="number">1</span>:</span><br><span class="line">   result = <span class="string">"one"</span>;</span><br><span class="line">   <span class="keyword">break</span>;</span><br><span class="line"><span class="keyword">default</span>:</span><br><span class="line">   result = <span class="string">"unknown"</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>switch不仅能让代码看起来简洁，而且非常高高效。  </p>
<h2 id="命名"><a href="#命名" class="headerlink" title="命名"></a>命名</h2><p>具体的请参阅<a href="https://github.com/wangduanduan/js-best-parctices/tree/master/docs" target="_blank" rel="noopener">这篇文章</a><br>这里只大概列举几点：  </p>
<ul>
<li>驼峰式命名</li>
<li>变量名以名词开头</li>
<li>方法名以动词开头</li>
<li>常量全部大写</li>
<li>构造函数以大写字母开头</li>
</ul>
<h2 id="其它"><a href="#其它" class="headerlink" title="其它"></a>其它</h2><p>以前有写过一个关于写js的一些规范或者说是自己看完一些文章后的沉思吧，也一并放出来分享了。  </p>
<h3 id="一段好的代码应该是怎样的？"><a href="#一段好的代码应该是怎样的？" class="headerlink" title="一段好的代码应该是怎样的？"></a>一段好的代码应该是怎样的？</h3><p>试想，当你在学一个业务代码的时候，你是否想过如果参数不是我想要的会怎样、如果出现了异常错误会怎样、如果突然要改需求了会怎样、如果这个参数不存在会怎样，我想都是没有的，你只是关注了结果，却始终没有考虑过边界状态，没有考虑过异常、兼容性以及校验，这很糟糕，非常糟糕。<br>所以一段好的代码应该是怎样的呢？<br><strong>1.可用</strong></p>
<blockquote>
<p>必须确保自己写的代码是可以正常运行并得到想要的结果的，否则那就是无效代码. </p>
</blockquote>
<p><strong>2.健壮</strong></p>
<blockquote>
<p>①当存在参数或需要用户输入时，是否判断参数、用户输入存在？<br>②当参数或用户输入不符合要求时，是否做处理？<br>③当你使用的方法可能在别的浏览器不兼容时，是否做处理？</p>
</blockquote>
<p><strong>3.可靠</strong></p>
<blockquote>
<p>是否在所有情况下都能输出一个可靠的值？</p>
</blockquote>
<p><strong>4.宽容</strong></p>
<blockquote>
<p>①是否有足够的注释，让其他开发人员读懂？<br>②是否能在需求更改时快速更改而不需要大动干戈？<br>③当参数或用户输入不符合要求时，是否能将其转成可用参数？</p>
</blockquote>
<h3 id="一个例子"><a href="#一个例子" class="headerlink" title="一个例子"></a>一个例子</h3><p>要求：编写一个javscript函数 fn，该函数有一个参数 n（数字类型），其返回值是一个数组，该数组内是 n 个随机且不重复的整数，且整数取值范围是 [2, 32]。</p>
<p>代码：<br><img src="/images/example.png" alt="example"></p>
</div><div class="post-footer"><div class="meta"><div class="info"><i class="fa fa-sun-o"></i><span class="date">2018-03-01</span><i class="fa fa-tag"></i><a class="tag" href="/categories/技术/" title="技术">技术 </a><a class="tag" href="/tags/js/" title="js">js </a></div></div></div></div><div class="share"><!--.evernotea.fa.fa-bookmark(href="javascript:(function(){EN_CLIP_HOST='http://www.evernote.com';try{var%20x=document.createElement('SCRIPT');x.type='text/javascript';x.src=EN_CLIP_HOST+'/public/bookmarkClipper.js?'+(new%20Date().getTime()/100000);document.getElementsByTagName('head')[0].appendChild(x);}catch(e){location.href=EN_CLIP_HOST+'/clip.action?url='+encodeURIComponent(location.href)+'&title='+encodeURIComponent(document.title);}})();", ref="nofollow", target="_blank")--><!--.weiboa.fa.fa-weibo(href="javascript:void((function(s,d,e){try{}catch(e){}var f='http://service.weibo.com/share/share.php?',u=d.location.href,p=['url=',e(u),'&title=',e(d.title),'&appkey=2924220432'].join('');function a(){if(!window.open([f,p].join(''),'mb',['toolbar=0,status=0,resizable=1,width=620,height=450,left=',(s.width-620)/2,',top=',(s.height-450)/2].join('')))u.href=[f,p].join('');};if(/Firefox/.test(navigator.userAgent)){setTimeout(a,0)}else{a()}})(screen,document,encodeURIComponent));")--><!--.twittera.fa.fa-twitter(href=url_for("http://twitter.com/home?status="+","+config.url+"/"+page.path+","+config.title+","+page.title+",;"))--></div><div class="pagination"><ul class="clearfix"><li class="next pagbuttons"><a class="btn" role="navigation" href="/2018/03/01/说说我理解的跨域/" title="说说我理解的跨域">下一篇</a></li></ul></div></div></div></div></div><script src="/js/jquery.js"></script><script src="/js/jquery-migrate-1.2.1.min.js"></script><script src="/js/jquery.appear.js"></script></body></html>