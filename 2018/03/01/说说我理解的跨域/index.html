<!DOCTYPE html><html lang="zh-CN"><head><meta charset="utf-8"><meta name="X-UA-Compatible" content="IE=edge"><meta name="author" content="Author hank.qin1994@gmail.com"><title>说说我理解的跨域 · Hank</title><meta name="description" content="作为一个前端er，跨域这方面的知识是必须掌握的，只是说究竟是完全理解透了还是只是在会用这个层面。我的目标是把它理解透了，只有这样才能在碰到很复杂的问题时不至于无从下手。
跨域是个啥在上一篇文章里，我说了从输入一个url到回车究竟发生了什么，读过就知道实际上浏览器是从服务器上获取文件然后进行渲染解析等"><meta name="keywords"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="renderer" content="webkit"><link rel="short icon" href="/images/favicon.png" type="image/x-icon"><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/css/blog_basic.css"><link rel="stylesheet" href="/css/font-awesome.min.css"><link rel="alternate" type="application/atom+xml" title="ATOM 1.0" href="/atom.xml"></head><body><div class="sidebar animated fadeInDown"><div class="logo-title"><div class="title"><img src="/images/19928429.png" style="width:127px;"><h3 title=""><a href="/">Hank</a></h3><div class="description"><p>一个前端开发er</p></div></div></div><ul class="social-links"><li><a href="https://github.com/hankqin"><i class="fa fa-github"></i></a></li></ul><div class="footer"><p class="coding">Hosted by <a href="https://pages.coding.me">Coding Pages</a></p></div></div><div class="main"><div class="page-top animated fadeInDown"><div class="nav"><li><a href="/">首页</a></li><li><a href="/about">关于</a></li><li><a href="/archives">归档</a></li><!--liif is_current('links')
  a.current(href="/links")= __('Links')					
else
  a(href="/links")= __('Links')		--></div><div class="information"><div class="back_btn"><li><a class="fa fa-chevron-left" onclick="window.history.go(-1)"> </a></li></div><div class="avatar"><img src="/images/favicon.png"></div></div></div><div class="autopagerize_page_element"><div class="content"><div class="post-page"><div class="post animated fadeInDown"><div class="post-title"><h3><a>说说我理解的跨域</a></h3></div><div class="post-content"><p>作为一个前端er，跨域这方面的知识是必须掌握的，只是说究竟是完全理解透了还是只是在会用这个层面。<br>我的目标是把它理解透了，只有这样才能在碰到很复杂的问题时不至于无从下手。</p>
<h2 id="跨域是个啥"><a href="#跨域是个啥" class="headerlink" title="跨域是个啥"></a>跨域是个啥</h2><p>在上一篇文章里，我说了从输入一个url到回车究竟发生了什么，读过就知道实际上浏览器是从服务器上获取文件然后进行渲染解析等操作，按照这个过程，我浏览器是不是只要有地址就随便取别人服务器上的东西呢？<br>答案是否定的，相信作为一个从业者你也能想到，这一定会带来一些安全问题，浏览器自然也想到了，所以很久以前Netscape就提出了<strong>同源策略</strong>，定义是：  </p>
<blockquote>
<p>同源策略限制从一个源加载的文档或脚本如何与来自另一个源的资源进行交互。这是一个用于隔离潜在恶意文件的关键的安全机制。  </p>
</blockquote>
<p>那么现在就有一个问题了，同源同源，那这个源到底是个啥玩意？<br>其实，源是由URI，主机名，端口号组合而成的。   <br><br>所以可想而知，在下面几种情况下资源不符合同源策略：  </p>
<ol>
<li>不同域名，如：<a href="http://www.hankqin.com" target="_blank" rel="noopener">http://www.hankqin.com</a> 和 <a href="http://www.qinhank.com" target="_blank" rel="noopener">http://www.qinhank.com</a></li>
<li>相同域名不同端口号，如：<a href="http://www.hankqin.com:8080" target="_blank" rel="noopener">http://www.hankqin.com:8080</a> 和 <a href="http://www.hankqin.com:8081" target="_blank" rel="noopener">http://www.hankqin.com:8081</a></li>
<li>同一个域名不同协议</li>
<li>主域和子域，如<a href="http://www.hankqin.com" target="_blank" rel="noopener">http://www.hankqin.com</a> 和 <a href="http://blog.hankqin.com">http://blog.hankqin.com</a></li>
<li>子域和子域，如<a href="http://blog.hankqin.com">http://blog.hankqin.com</a> 和 <a href="http://page.hankqin.com" target="_blank" rel="noopener">http://page.hankqin.com</a>  <br></li>
</ol>
<p>基于以上，跨域的定义也就自然出来了：  </p>
<blockquote>
<p>跨域，指的是浏览器不能执行其他网站的脚本。</p>
</blockquote>
<h2 id="解决跨域"><a href="#解决跨域" class="headerlink" title="解决跨域"></a>解决跨域</h2><p>知道了问题所在，就需要针对它做出相应的解决方案了。<br>常见的解决方案有：  </p>
<ol>
<li>JSONP</li>
<li>跨域资源共享(CORS)</li>
<li>document.domain+iframe（适用于主域名相同的情况）</li>
<li>window.name + iframe</li>
<li>postMessage（适用于两个iframe或两个页面之间）</li>
<li>location.hash + iframe（适用于两个iframe之间）  </li>
</ol>
<h3 id="JSONP"><a href="#JSONP" class="headerlink" title="JSONP"></a>JSONP</h3><p>这个方案我想应该是目前用的最多的。它的原理很简单：<br>作为从业者基本都知道script、img、link标签实际上使用的是开发策略，所以实际上我们是可以随便引用非同源的脚本的，JSONP就是基于这个策略实现的，具体过程如下：  </p>
<ol>
<li>前后端约定特定字符为JSONP返回(一般使用callback)  </li>
<li>定义一个全局可访问的函数，参数即为服务器返回的数据，如:jsonpFn(data){}  </li>
<li>通过script标签执行函数，如:    <figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;script src=<span class="string">"http://baidu.com?callback=jsonpFn&amp;data=getJsonpData"</span>&gt;&lt;/script&gt;</span><br></pre></td></tr></table></figure>
</li>
</ol>
<p>自此，跨域完成，数据成功返回并运行。<br>但正如你所见，JSONP只支持GET方法，对于POST是无力的。  </p>
<h3 id="CORS"><a href="#CORS" class="headerlink" title="CORS"></a>CORS</h3><p>即跨域资源共享，关于这个更详细的说明请看阮一峰老师的<a href="http://www.ruanyifeng.com/blog/2016/04/cors.html" target="_blank" rel="noopener">跨域资源共享 CORS 详解</a>。<br>作为前端，实际上在CORS中需要做的不多，主要是后端。<br>浏览器CORS请求分成两种：  </p>
<ol>
<li>简单请求</li>
<li>协商模型/预检请求（Preflighted Request），即非简单请求  </li>
</ol>
<p>这两种有什么分别呢，又是怎么区分呢？<br>一般来说，只要满足亮点，那它就是简单请求，否则则为非简单请求：  </p>
<ol>
<li>请求方式为<strong>GET</strong>、<strong>POST</strong>、<strong>HEAD</strong></li>
<li>HTTP的头信息子段</li>
</ol>
<ul>
<li>Accept</li>
<li>Accept-Language</li>
<li>Content-Language</li>
<li>Last-Event-ID</li>
<li>Content-Type：只限于三个值application/x-www-form-urlencoded、multipart/form-data、text/plain，其中’text/plain’默认支持，其他两种则需要预检请求和服务器协商。</li>
</ul>
<p>其余的我不太想说了，实际应用中都会有些不够完美。<br>更多细节请<a href="https://zhuanlan.zhihu.com/p/25654664" target="_blank" rel="noopener">狂点我查看</a></p>
</div><div class="post-footer"><div class="meta"><div class="info"><i class="fa fa-sun-o"></i><span class="date">2018-03-01</span><i class="fa fa-tag"></i><a class="tag" href="/categories/技术/" title="技术">技术 </a><a class="tag" href="/tags/跨域/" title="跨域">跨域 </a></div></div></div></div><div class="share"><!--.evernotea.fa.fa-bookmark(href="javascript:(function(){EN_CLIP_HOST='http://www.evernote.com';try{var%20x=document.createElement('SCRIPT');x.type='text/javascript';x.src=EN_CLIP_HOST+'/public/bookmarkClipper.js?'+(new%20Date().getTime()/100000);document.getElementsByTagName('head')[0].appendChild(x);}catch(e){location.href=EN_CLIP_HOST+'/clip.action?url='+encodeURIComponent(location.href)+'&title='+encodeURIComponent(document.title);}})();", ref="nofollow", target="_blank")--><!--.weiboa.fa.fa-weibo(href="javascript:void((function(s,d,e){try{}catch(e){}var f='http://service.weibo.com/share/share.php?',u=d.location.href,p=['url=',e(u),'&title=',e(d.title),'&appkey=2924220432'].join('');function a(){if(!window.open([f,p].join(''),'mb',['toolbar=0,status=0,resizable=1,width=620,height=450,left=',(s.width-620)/2,',top=',(s.height-450)/2].join('')))u.href=[f,p].join('');};if(/Firefox/.test(navigator.userAgent)){setTimeout(a,0)}else{a()}})(screen,document,encodeURIComponent));")--><!--.twittera.fa.fa-twitter(href=url_for("http://twitter.com/home?status="+","+config.url+"/"+page.path+","+config.title+","+page.title+",;"))--></div><div class="pagination"><ul class="clearfix"><li class="pre pagbuttons"><a class="btn" role="navigation" href="/2018/03/01/编写可维护的js/" title="编写可维护的js">上一篇</a></li><li class="next pagbuttons"><a class="btn" role="navigation" href="/2018/02/28/从输入一个URL到回车/" title="从输入一个URL到回车">下一篇</a></li></ul></div></div></div></div></div><script src="/js/jquery.js"></script><script src="/js/jquery-migrate-1.2.1.min.js"></script><script src="/js/jquery.appear.js"></script></body></html>